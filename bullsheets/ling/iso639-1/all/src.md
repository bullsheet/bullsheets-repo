219 lines
https://gist.github.com/elegantcoder/6993828